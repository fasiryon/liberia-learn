{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "LiberiaLearn Unified Curriculum Schema (v2 - FULL_SUBJECT)",
  "type": "object",
  "additionalProperties": false,
  "required": ["metadata", "educational_context", "title", "content_type", "scale", "units"],
  "properties": {
    "metadata": { "$ref": "#/definitions/metadata" },
    "educational_context": { "$ref": "#/definitions/educational_context" },
    "standards_alignment": { "$ref": "#/definitions/standards_alignment" },
    "title": { "type": "string" },
    "description": { "type": "string" },

    "content_type": {
      "type": "string",
      "enum": ["LESSON", "UNIT", "TERM", "FULL_SUBJECT"]
    },

    "scale": {
      "type": "string",
      "enum": ["FULL_SUBJECT"]
    },

    "grade_range": {
      "type": "object",
      "additionalProperties": false,
      "required": ["min_grade", "max_grade"],
      "properties": {
        "min_grade": { "type": "string", "enum": ["K", "1","2","3","4","5","6","7","8","9","10","11","12"] },
        "max_grade": { "type": "string", "enum": ["K", "1","2","3","4","5","6","7","8","9","10","11","12"] }
      }
    },

    "stemdna": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "inspiration": {
          "type": "array",
          "items": { "type": "string" },
          "description": "e.g., Singapore mastery, Finland depth, Japan problem-solving"
        },
        "localization_notes": { "type": "string" }
      }
    },

    "units": {
      "type": "array",
      "minItems": 5,
      "maxItems": 12,
      "items": { "$ref": "#/definitions/unit" }
    }
  },

  "definitions": {
    "metadata": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "version", "created_at", "updated_at", "status"],
      "properties": {
        "id": { "type": "string", "pattern": "^(LESSON|UNIT|TERM|SUBJECT)-[A-Z0-9]+$" },
        "version": { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+$" },
        "created_at": { "type": "string", "format": "date-time" },
        "updated_at": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["draft","review","approved","published","archived"] }
      }
    },

    "educational_context": {
      "type": "object",
      "additionalProperties": false,
      "required": ["grade", "subject", "cognitive_band"],
      "properties": {
        "grade": { "type": "integer", "minimum": 1, "maximum": 12 },
        "subject": {
          "type": "string",
          "enum": ["MATH","ENGLISH","SCIENCE","PHYSICS","CHEMISTRY","BIOLOGY","COMPUTER_SCIENCE","ICT","HISTORY","CIVICS","GEOGRAPHY","ECONOMICS","BUSINESS_STUDIES","ARTS","CREATIVITY","PE","LITERACY"]
        },
        "cognitive_band": { "type": "string", "enum": ["FOUNDATION","CORE","SPECIALIZATION"] },
        "term": { "type": "integer", "minimum": 1, "maximum": 3 },
        "week": { "type": "integer", "minimum": 1 }
      }
    },

    "standards_alignment": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "liberia_moe": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "standard_codes": { "type": "array", "items": { "type": "string" } },
            "learning_outcomes": { "type": "array", "items": { "type": "string" } }
          }
        },
        "waec": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "applicable": { "type": "boolean" },
            "syllabus_ref": { "type": "string" },
            "exam_topics": { "type": "array", "items": { "type": "string" } }
          }
        },
        "global_benchmarks": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "source_countries": { "type": "array", "items": { "type": "string" } },
            "frameworks": { "type": "array", "items": { "type": "string" } },
            "adaptation_notes": { "type": "string" }
          }
        }
      }
    },

    "unit": {
      "type": "object",
      "additionalProperties": false,
      "required": ["unit_id", "unit_title", "lessons"],
      "properties": {
        "unit_id": { "type": "string" },
        "unit_title": { "type": "string" },
        "description": { "type": "string" },
        "lessons": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/definitions/lesson" }
        }
      }
    },

    "lesson": {
      "type": "object",
      "additionalProperties": false,
      "required": ["lesson_id", "lesson_title", "lesson_content", "ai_tutor", "virtual_lab"],
      "properties": {
        "lesson_id": { "type": "string" },
        "lesson_title": { "type": "string" },

        "lesson_content": {
          "type": "object",
          "additionalProperties": false,
          "required": ["learning_objectives", "activities", "assessments"],
          "properties": {
            "prerequisites": { "type": "array", "items": { "type": "string" } },

            "learning_objectives": {
              "type": "array",
              "minItems": 1,
              "items": { "$ref": "#/definitions/learning_objective" }
            },

            "activities": {
              "type": "array",
              "minItems": 1,
              "items": { "$ref": "#/definitions/activity" }
            },

            "assessments": {
              "type": "array",
              "minItems": 1,
              "items": { "$ref": "#/definitions/assessment" }
            },

            "cultural_context": { "$ref": "#/definitions/cultural_context" },
            "technical_metadata": { "$ref": "#/definitions/technical_metadata" }
          }
        },

        "ai_tutor": { "$ref": "#/definitions/ai_tutor" },

        "virtual_lab": { "$ref": "#/definitions/virtual_lab_v2" }
      }
    },

    "ai_tutor": {
      "type": "object",
      "additionalProperties": false,
      "required": ["hint_strategy", "common_misconceptions", "mastery_check"],
      "properties": {
        "hint_strategy": { "type": "string", "enum": ["progressive","socratic","direct","example_based"] },
        "common_misconceptions": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["misconception", "correction"],
            "properties": {
              "misconception": { "type": "string" },
              "correction": { "type": "string" }
            }
          }
        },
        "mastery_check": {
          "type": "object",
          "additionalProperties": false,
          "required": ["method", "threshold"],
          "properties": {
            "method": { "type": "string", "enum": ["exit_ticket","mini_quiz","performance_task","oral_check"] },
            "threshold": { "type": "number", "minimum": 0, "maximum": 1 }
          }
        }
      }
    },

    "virtual_lab_v2": {
      "type": ["object", "null"],
      "additionalProperties": false,
      "required": ["lab_type", "learning_goal", "interaction_model", "offline_fallback"],
      "properties": {
        "lab_type": { "type": "string", "enum": ["SIMULATION","GUIDED_EXPERIMENT","DATA_ANALYSIS","MODEL_BUILDING"] },
        "learning_goal": { "type": "string" },
        "interaction_model": { "type": "string", "enum": ["text_guided","interactive_simulation","full_3d"] },
        "offline_fallback": { "type": "string" },
        "notes": { "type": "string" }
      }
    },

    "learning_objective": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "statement", "bloom_level"],
      "properties": {
        "id": { "type": "string" },
        "statement": { "type": "string" },
        "bloom_level": { "type": "string", "enum": ["REMEMBER","UNDERSTAND","APPLY","ANALYZE","EVALUATE","CREATE"] },
        "assessment_method": { "type": "string" },
        "success_criteria": { "type": "array", "items": { "type": "string" } }
      }
    },

    "activity": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "type", "title", "duration_minutes", "offline_capable"],
      "properties": {
        "id": { "type": "string" },
        "type": { "type": "string", "enum": ["VISUAL","INTERACTIVE","PRACTICE","DISCUSSION","VIRTUAL_LAB","PROJECT","INQUIRY","READING","WRITING","PRESENTATION"] },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "duration_minutes": { "type": "integer" },
        "offline_capable": { "type": "boolean" },
        "instructions": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "student": { "type": "string" },
            "teacher": { "type": "string" }
          }
        }
      }
    },

    "assessment": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "type", "questions"],
      "properties": {
        "id": { "type": "string" },
        "type": { "type": "string", "enum": ["FORMATIVE","SUMMATIVE","DIAGNOSTIC","SELF_CHECK"] },
        "format": { "type": "string", "enum": ["MCQ","SHORT_ANSWER","ESSAY","PROJECT","LAB_REPORT","CODE"] },
        "time_limit_minutes": { "type": "integer" },
        "mastery_threshold": { "type": "number", "minimum": 0, "maximum": 1 },
        "adaptive": { "type": "boolean" },
        "questions": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["id", "question", "points"],
            "properties": {
              "id": { "type": "string" },
              "question": { "type": "string" },
              "type": { "type": "string", "enum": ["MCQ","TRUE_FALSE","SHORT_ANSWER","ESSAY","CODE","MATCHING"] },
              "points": { "type": "integer" },
              "difficulty": { "type": "string", "enum": ["D1","D2","D3","D4","D5"] },
              "options": { "type": "array", "items": { "type": "string" } },
              "correct_answer": {},
              "explanation": { "type": "string" },
              "hints": { "type": "array", "items": { "type": "string" } },
              "rubric": { "type": "object" },
              "ai_gradable": { "type": "boolean" }
            }
          }
        }
      }
    },

    "cultural_context": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "local_examples": { "type": "array", "items": { "type": "string" } },
        "language_notes": { "type": "string" },
        "real_world_applications": { "type": "array", "items": { "type": "string" } },
        "community_connections": { "type": "array", "items": { "type": "string" } }
      }
    },

    "technical_metadata": {
      "type": "object",
      "additionalProperties": false,
      "required": ["offline_capable", "estimated_storage_mb"],
      "properties": {
        "offline_capable": { "type": "boolean" },
        "sync_required": { "type": "string", "enum": ["none","optional","required"] },
        "estimated_storage_mb": { "type": "number" }
      }
    }
  }
}
